{"is_source_file": true, "format": "Python", "description": "This file defines FastAPI routes for managing Atlassian OAuth 2.0 (3LO) authentication with PKCE, as well as some legacy Jira OAuth handlers. It includes endpoints for starting OAuth login flows, handling OAuth callbacks, token refresh, resource listing, and configuration diagnostics. The code manages session state, constructs OAuth URLs, exchanges authorization codes for tokens, and secures the process with session cookies.", "external_files": ["./oauth_pkce", "./oauth_settings", "./oauth_config"], "external_methods": ["generate_code_verifier", "generate_code_challenge", "generate_state", "get_or_create_session_id", "save_session", "get_session", "save_tokens", "get_atlassian_oauth_config", "get_default_scopes", "get_jira_oauth_config", "get_frontend_base_url_default"], "published": ["atlassian_login", "jira_login_legacy", "oauth_start", "list_routes", "atlassian_callback", "atlassian_refresh", "list_accessible_resources", "jira_callback_legacy", "get_effective_config"], "classes": [], "methods": [{"name": "None _set_session_cookie(resp: Response, session_id: str)", "description": "Sets a secure, httpOnly session cookie named 'sid' with a specified session ID.", "scope": "", "scopeKind": ""}, {"name": "atlassian_login(request: Request, state: Optional[str] = None, scope: Optional[str] = None)", "description": "Initiates OAuth login flow with PKCE, generating code verifier, challenge, and state, then redirects to Atlassian authorization URL.", "scope": "", "scopeKind": ""}, {"name": "jira_login_legacy(state: Optional[str] = None, scope: Optional[str] = None)", "description": "Starts a legacy Jira OAuth flow using client secret, redirecting to Atlassian authorization URL.", "scope": "", "scopeKind": ""}, {"name": "oauth_start(request: Request)", "description": "Shim endpoint supporting legacy clients, redirects to /api/oauth/atlassian/login, preserving optional redirect URL.", "scope": "", "scopeKind": ""}, {"name": "list_routes(request: Request)", "description": "Returns a diagnostic list of all registered routes and methods in the FastAPI app.", "scope": "", "scopeKind": ""}, {"name": "atlassian_callback(request: Request, code: Optional[str] = None, state: Optional[str] = None)", "description": "Handles OAuth callback from Atlassian, validates state, exchanges code for tokens, and redirects to frontend with status.", "scope": "", "scopeKind": ""}, {"name": "atlassian_refresh(request: Request)", "description": "Uses stored refresh token to obtain a new access token and updates session tokens.", "scope": "", "scopeKind": ""}, {"name": "list_accessible_resources(request: Request)", "description": "Calls Atlassian API to list accessible cloud resources using the stored access token.", "scope": "", "scopeKind": ""}, {"name": "jira_callback_legacy(request: Request, code: Optional[str] = None, state: Optional[str] = None)", "description": "Handles legacy Jira OAuth callback, exchanges code for tokens without session persistence, then redirects.", "scope": "", "scopeKind": ""}, {"name": "get_effective_config()", "description": "Returns current OAuth configuration details (URLs, redirect URI) for diagnostics.", "scope": "", "scopeKind": ""}], "calls": ["get_or_create_session_id", "save_session", "get_session", "save_tokens", "get_atlassian_oauth_config", "get_default_scopes", "get_jira_oauth_config", "get_frontend_base_url_default", "httpx.AsyncClient", "urllib.parse.urlencode", "logging.getLogger", "session.get", "session_id", "session", "session.token_set.access_token", "session.token_set.refresh_token"], "search-terms": ["OAuth", "PKCE", "Atlassian", "Jira", "session management", "token exchange", "legacy shim", "resource listing", "configuration diagnostics", "redirect handling"], "state": 2, "file_id": 15, "knowledge_revision": 109, "git_revision": "d230454ff52a62b345d74cd3be8a262a941138ad", "revision_history": [{"54": ""}, {"62": "837fa352878d17e969ace40bf39f6914f4a39086"}, {"63": "837fa352878d17e969ace40bf39f6914f4a39086"}, {"64": "837fa352878d17e969ace40bf39f6914f4a39086"}, {"71": "c93612d2bfe887131d75d6aa4e2e91677266f41a"}, {"72": "c93612d2bfe887131d75d6aa4e2e91677266f41a"}, {"82": "e8e3b6b27369df561751d9f3714fa96ba8473925"}, {"91": "bfdff7245da8e6ccd5a638f7c0975df5e7722a10"}, {"92": "bfdff7245da8e6ccd5a638f7c0975df5e7722a10"}, {"99": "a49d74ce2b4dbb9d625dc75710bb24953cac1b24"}, {"100": "a49d74ce2b4dbb9d625dc75710bb24953cac1b24"}, {"103": "31c224f85b3a8ac8246306807a1e22e3a731efd7"}, {"104": "31c224f85b3a8ac8246306807a1e22e3a731efd7"}, {"105": "31c224f85b3a8ac8246306807a1e22e3a731efd7"}, {"107": "d230454ff52a62b345d74cd3be8a262a941138ad"}, {"108": "d230454ff52a62b345d74cd3be8a262a941138ad"}, {"109": "d230454ff52a62b345d74cd3be8a262a941138ad"}], "ctags": [{"_type": "tag", "name": "_set_session_cookie", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_atlassian.py", "pattern": "/^def _set_session_cookie(resp: Response, session_id: str) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(resp: Response, session_id: str)"}, {"_type": "tag", "name": "atlassian_callback", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_atlassian.py", "pattern": "/^async def atlassian_callback(request: Request, code: Optional[str] = None, state: Optional[str] /", "language": "Python", "kind": "function", "signature": "(request: Request, code: Optional[str] = None, state: Optional[str] = None)"}, {"_type": "tag", "name": "atlassian_login", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_atlassian.py", "pattern": "/^async def atlassian_login(request: Request, state: Optional[str] = None, scope: Optional[str] = /", "language": "Python", "kind": "function", "signature": "(request: Request, state: Optional[str] = None, scope: Optional[str] = None)"}, {"_type": "tag", "name": "atlassian_refresh", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_atlassian.py", "pattern": "/^async def atlassian_refresh(request: Request):$/", "language": "Python", "kind": "function", "signature": "(request: Request)"}, {"_type": "tag", "name": "get_effective_config", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_atlassian.py", "pattern": "/^async def get_effective_config():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "jira_callback_legacy", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_atlassian.py", "pattern": "/^async def jira_callback_legacy(request: Request, code: Optional[str] = None, state: Optional[str/", "language": "Python", "kind": "function", "signature": "(request: Request, code: Optional[str] = None, state: Optional[str] = None)"}, {"_type": "tag", "name": "jira_login_legacy", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_atlassian.py", "pattern": "/^async def jira_login_legacy(state: Optional[str] = None, scope: Optional[str] = None):$/", "language": "Python", "kind": "function", "signature": "(state: Optional[str] = None, scope: Optional[str] = None)"}, {"_type": "tag", "name": "list_accessible_resources", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_atlassian.py", "pattern": "/^async def list_accessible_resources(request: Request):$/", "language": "Python", "kind": "function", "signature": "(request: Request)"}, {"_type": "tag", "name": "list_routes", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_atlassian.py", "pattern": "/^async def list_routes(request: Request):$/", "language": "Python", "kind": "function", "signature": "(request: Request)"}, {"_type": "tag", "name": "oauth_start", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_atlassian.py", "pattern": "/^async def oauth_start(request: Request):$/", "language": "Python", "kind": "function", "signature": "(request: Request)"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_atlassian.py", "pattern": "/^router = APIRouter()$/", "language": "Python", "kind": "variable"}], "hash": "a94bf95b81cf2826ffcfba1911a2983d", "format-version": 4, "code-base-name": "integration_backend", "filename": "integration_backend/src/api/oauth_atlassian.py", "fields": [{"name": "router = APIRouter()", "scope": "", "scopeKind": "", "description": "unavailable"}]}