{"is_source_file": true, "format": "Python", "description": "This file provides a Redis client utility for OAuth state storage, including fallback to in-memory storage for development or testing. It manages storing, retrieving, and consuming OAuth states with TTL support, and includes diagnostic functions.", "external_files": ["src/startup"], "external_methods": ["redis.from_url"], "published": ["has_redis", "get_state_ttl_seconds", "save_oauth_state", "get_oauth_state", "consume_oauth_state", "export_oauth_state_diagnostics"], "classes": [], "methods": [{"name": "int _get_ttl_seconds()", "description": "Resolves the TTL seconds for OAuth state storage from environment variable.", "scope": "", "scopeKind": ""}, {"name": "str _namespace_key(key: str)", "description": "Creates a namespaced key for OAuth state storage.", "scope": "", "scopeKind": ""}, {"name": "None _prune_memory_store()", "description": "Removes expired entries from the in-memory store.", "scope": "", "scopeKind": ""}, {"name": "_get_redis_client()", "description": "Initializes and returns a Redis client if configured and reachable; otherwise None.", "scope": "", "scopeKind": ""}, {"name": "bool has_redis()", "description": "Checks if Redis backend is configured and reachable.", "scope": "", "scopeKind": ""}, {"name": "int get_state_ttl_seconds()", "description": "Returns the configured TTL for OAuth state storage.", "scope": "", "scopeKind": ""}, {"name": "None save_oauth_state(state: str, payload: Dict[str, Any])", "description": "Stores OAuth state and payload with a TTL, using Redis or in-memory fallback.", "scope": "", "scopeKind": ""}, {"name": "Optional[Dict[str,Any]] get_oauth_state(state: str)", "description": "Retrieves OAuth state payload without consuming it.", "scope": "", "scopeKind": ""}, {"name": "Optional[Dict[str,Any]] consume_oauth_state(state: str)", "description": "Atomically retrieves and deletes OAuth state payload for single use.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,Any] export_oauth_state_diagnostics(limit: int = 50)", "description": "Provides diagnostic info about current active OAuth states in backend.", "scope": "", "scopeKind": ""}], "calls": ["redis.from_url", "client.ping", "client.setex", "client.get", "client.execute_command", "client.pipeline", "client.scan"], "search-terms": ["OAuth state storage", "Redis fallback", "in-memory cache", "OAuth state TTL", "oauth:state:", "state management", "diagnostics"], "state": 2, "file_id": 29, "knowledge_revision": 181, "git_revision": "", "ctags": [{"_type": "tag", "name": "_MEMORY_LOCK", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^_MEMORY_LOCK = threading.Lock()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_MEMORY_STORE", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^_MEMORY_STORE: Dict[str, Tuple[str, int]] = {}$/", "language": "Python", "typeref": "typename:Dict[str, Tuple[str, int]]", "kind": "variable"}, {"_type": "tag", "name": "_get_redis_client", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^def _get_redis_client():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_get_ttl_seconds", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^def _get_ttl_seconds() -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_logger", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^_logger = logging.getLogger(\"redis.client\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_namespace_key", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^def _namespace_key(key: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(key: str)"}, {"_type": "tag", "name": "_prune_memory_store", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^def _prune_memory_store() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "consume_oauth_state", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^def consume_oauth_state(state: str) -> Optional[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:Optional[Dict[str,Any]]", "kind": "function", "signature": "(state: str)"}, {"_type": "tag", "name": "export_oauth_state_diagnostics", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^def export_oauth_state_diagnostics(limit: int = 50) -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(limit: int = 50)"}, {"_type": "tag", "name": "get_oauth_state", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^def get_oauth_state(state: str) -> Optional[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:Optional[Dict[str,Any]]", "kind": "function", "signature": "(state: str)"}, {"_type": "tag", "name": "get_state_ttl_seconds", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^def get_state_ttl_seconds() -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "has_redis", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^def has_redis() -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "redis", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^    redis = None  # type: ignore$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "save_oauth_state", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^def save_oauth_state(state: str, payload: Dict[str, Any]) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(state: str, payload: Dict[str, Any])"}], "hash": "636385b85a2fa3ca09d5e63322b63f89", "format-version": 4, "code-base-name": "integration_backend", "filename": "integration_backend/src/api/redis_client.py", "fields": [{"name": "_MEMORY_LOCK = threading.Lock()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str, Tuple[str, int]] _MEMORY_STORE", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_logger = logging.getLogger(\"redis.client\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "redis = None  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"181": ""}]}