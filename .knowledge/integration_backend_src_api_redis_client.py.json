{"is_source_file": true, "format": "Python", "description": "This file provides a Redis client utility with fallback to in-memory storage, used for storing, retrieving, and deleting ephemeral OAuth state data with TTL management. It includes functions for checking Redis availability, saving and consuming OAuth states, and diagnostics.", "external_files": ["src.startup"], "external_methods": ["redis.from_url", "redis.ping", "redis.setex", "redis.execute_command", "redis.pipeline", "redis.scan"], "published": ["has_redis", "get_state_ttl_seconds", "save_oauth_state", "get_oauth_state", "consume_oauth_state", "export_oauth_state_diagnostics"], "classes": [], "methods": [{"name": "int _get_ttl_seconds()", "description": "Resolve TTL seconds for OAuth state storage, defaulting to 600 if not set or invalid.", "scope": "", "scopeKind": ""}, {"name": "str _namespace_key(key: str)", "description": "Apply a namespaced prefix ('oauth:state:') for keys.", "scope": "", "scopeKind": ""}, {"name": "None _prune_memory_store()", "description": "Remove expired entries from the in-memory store based on current time.", "scope": "", "scopeKind": ""}, {"name": "_get_redis_client()", "description": "Attempt to create and validate a Redis client using environment configuration; fallback to None if not available.", "scope": "", "scopeKind": ""}, {"name": "Optional[Dict[str,Any]] consume_oauth_state(state: str)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str,Any] export_oauth_state_diagnostics(limit: int = 50)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[Dict[str,Any]] get_oauth_state(state: str)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "int get_state_ttl_seconds()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "bool has_redis()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "None save_oauth_state(state: str, payload: Dict[str, Any])", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["redis.from_url", "redis.ping", "json.dumps", "json.loads", "time.time", "os.getenv", "client.setex", "client.get", "client.execute_command", "client.pipeline", "pipeline.get", "pipeline.delete", "client.scan", "_prune_memory_store"], "search-terms": ["Redis OAuth state storage", "in-memory fallback store", "OAuth state TTL", "oauth:state namespace", "redis connectivity check", "consume OAuth state", "OAuth state diagnostics", "_get_ttl_seconds", "save_oauth_state"], "state": 2, "file_id": 29, "knowledge_revision": 190, "git_revision": "16ede0da1cb5d681c89b4c436fa9519fb6fce853", "revision_history": [{"181": ""}, {"190": "16ede0da1cb5d681c89b4c436fa9519fb6fce853"}], "ctags": [{"_type": "tag", "name": "_MEMORY_LOCK", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^_MEMORY_LOCK = threading.Lock()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_MEMORY_STORE", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^_MEMORY_STORE: Dict[str, Tuple[str, int]] = {}$/", "language": "Python", "typeref": "typename:Dict[str, Tuple[str, int]]", "kind": "variable"}, {"_type": "tag", "name": "_get_redis_client", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^def _get_redis_client():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_get_ttl_seconds", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^def _get_ttl_seconds() -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_logger", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^_logger = logging.getLogger(\"redis.client\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_namespace_key", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^def _namespace_key(key: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(key: str)"}, {"_type": "tag", "name": "_prune_memory_store", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^def _prune_memory_store() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "consume_oauth_state", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^def consume_oauth_state(state: str) -> Optional[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:Optional[Dict[str,Any]]", "kind": "function", "signature": "(state: str)"}, {"_type": "tag", "name": "export_oauth_state_diagnostics", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^def export_oauth_state_diagnostics(limit: int = 50) -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(limit: int = 50)"}, {"_type": "tag", "name": "get_oauth_state", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^def get_oauth_state(state: str) -> Optional[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:Optional[Dict[str,Any]]", "kind": "function", "signature": "(state: str)"}, {"_type": "tag", "name": "get_state_ttl_seconds", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^def get_state_ttl_seconds() -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "has_redis", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^def has_redis() -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "redis", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^    redis = None  # type: ignore$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "save_oauth_state", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/redis_client.py", "pattern": "/^def save_oauth_state(state: str, payload: Dict[str, Any]) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(state: str, payload: Dict[str, Any])"}], "hash": "290d0803f53642ea7a4f5503897e6636", "format-version": 4, "code-base-name": "integration_backend", "filename": "integration_backend/src/api/redis_client.py", "fields": [{"name": "_MEMORY_LOCK = threading.Lock()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str, Tuple[str, int]] _MEMORY_STORE", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_logger = logging.getLogger(\"redis.client\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "redis = None  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}]}