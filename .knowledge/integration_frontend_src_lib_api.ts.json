{"is_source_file": true, "format": "TypeScript", "description": "This file implements an API helper function `apiFetch` that wraps the standard fetch API to include credentials, manage CSRF tokens automatically, and handle JSON responses intelligently. It specifically targets making state-changing requests more secure by attaching CSRF tokens and adjusting headers.", "external_files": ["fetch API (built-in)", "process.env for environment variables"], "external_methods": ["fetch()", "Headers()"], "published": ["apiFetch"], "classes": [], "methods": [{"name": "export async function apiFetch(input: RequestInfo, init: RequestInit = {}) { apiFetch", "description": "An asynchronous function that wraps fetch to add credentials, manage CSRF tokens for unsafe HTTP methods, set default headers, and handle response content.", "scope": "", "scopeKind": ""}], "calls": ["fetch()", "csrfRes.headers.get()", "csrfRes.json()"], "search-terms": ["api helper", "CSRF token management", "fetch wrapper", "state-changing requests", "TypeScript API"], "state": 2, "file_id": 47, "knowledge_revision": 408, "git_revision": "", "revision_history": [{"374": ""}, {"386": ""}, {"408": ""}], "ctags": [{"_type": "tag", "name": "apiFetch", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_frontend/src/lib/api.ts", "pattern": "/^ export async function apiFetch(input: RequestInfo, init: RequestInit = {}) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "backendBase", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_frontend/src/lib/api.ts", "pattern": "/^   const backendBase = process.env.NEXT_PUBLIC_BACKEND_BASE_URL || \"\";$/", "language": "TypeScript", "kind": "constant", "scope": "apiFetch", "scopeKind": "function"}, {"_type": "tag", "name": "credentials", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_frontend/src/lib/api.ts", "pattern": "/^   const reqInit: RequestInit = { ...init, credentials: \"include\", headers };$/", "language": "TypeScript", "kind": "constant", "scope": "apiFetch", "scopeKind": "function"}, {"_type": "tag", "name": "csrfJson", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_frontend/src/lib/api.ts", "pattern": "/^         const csrfJson: any = await csrfRes.json().catch(() => ({}));$/", "language": "TypeScript", "kind": "constant", "scope": "apiFetch", "scopeKind": "function"}, {"_type": "tag", "name": "csrfRes", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_frontend/src/lib/api.ts", "pattern": "/^       const csrfRes = await fetch(`${backendBase}\\/auth\\/csrf\\/resolve`, { credentials: \"includ/", "language": "TypeScript", "kind": "constant", "scope": "apiFetch", "scopeKind": "function"}, {"_type": "tag", "name": "ct", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_frontend/src/lib/api.ts", "pattern": "/^   const ct = res.headers.get(\"content-type\") || \"\";$/", "language": "TypeScript", "kind": "constant", "scope": "apiFetch", "scopeKind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_frontend/src/lib/api.ts", "pattern": "/^       const data = await res.clone().json();$/", "language": "TypeScript", "kind": "constant", "scope": "apiFetch", "scopeKind": "function"}, {"_type": "tag", "name": "headerToken", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_frontend/src/lib/api.ts", "pattern": "/^       const headerToken = csrfRes.headers.get(\"X-CSRF-Token\");$/", "language": "TypeScript", "kind": "constant", "scope": "apiFetch", "scopeKind": "function"}, {"_type": "tag", "name": "headers", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_frontend/src/lib/api.ts", "pattern": "/^   const headers = new Headers(init.headers as HeadersInit);$/", "language": "TypeScript", "kind": "constant", "scope": "apiFetch", "scopeKind": "function"}, {"_type": "tag", "name": "method", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_frontend/src/lib/api.ts", "pattern": "/^   const method = (init.method || \"GET\").toUpperCase();$/", "language": "TypeScript", "kind": "constant", "scope": "apiFetch", "scopeKind": "function"}, {"_type": "tag", "name": "reqInit", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_frontend/src/lib/api.ts", "pattern": "/^   const reqInit: RequestInit = { ...init, credentials: \"include\", headers };$/", "language": "TypeScript", "kind": "constant", "scope": "apiFetch", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_frontend/src/lib/api.ts", "pattern": "/^   const res = await fetch(input, reqInit);$/", "language": "TypeScript", "kind": "constant", "scope": "apiFetch", "scopeKind": "function"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_frontend/src/lib/api.ts", "pattern": "/^         const token = csrfJson?.token || csrfJson?.csrf || csrfJson?.csrf_token;$/", "language": "TypeScript", "kind": "constant", "scope": "apiFetch", "scopeKind": "function"}], "hash": "bb25d75399b0edcc98dc16ae1494e9a1", "format-version": 4, "code-base-name": "integration_backend", "filename": "integration_frontend/src/lib/api.ts"}