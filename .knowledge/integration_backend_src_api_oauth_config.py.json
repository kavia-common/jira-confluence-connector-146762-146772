{"is_source_file": true, "format": "Python", "description": "This file provides helpers and configuration management for OAuth integration with Atlassian products (JIRA and Confluence). It handles environment variable loading, URL construction, and diagnostic functions related to OAuth configuration.", "external_files": ["dotenv", "os", "urllib.parse", "pydantic", "fastapi.Request"], "external_methods": ["load_dotenv", "find_dotenv", "os.getenv", "urllib.parse.urlparse", "urllib.parse.urlunparse"], "published": ["get_atlassian_base_url", "choose_jira_redirect_with_request", "get_jira_oauth_config", "get_confluence_oauth_config", "get_frontend_base_url_default", "is_jira_oauth_configured", "build_atlassian_authorize_url", "get_jira_oauth_env_debug", "get_env_bootstrap_debug", "get_active_redirect_uris_debug"], "classes": [{"name": "Settings", "description": "Configuration class that encapsulates environment-based settings for OAuth and other app parameters."}], "methods": [{"name": "None _load_env_once()", "description": "Loads environment variables from a .env file based on various candidate paths, ensuring single load at startup.", "scope": "", "scopeKind": ""}, {"name": "str _env_first(*names: str)", "description": "Returns the value of the first set environment variable among provided names.", "scope": "", "scopeKind": ""}, {"name": "str _mask_secret(value: Optional[str], keep: int = 4)", "description": "Masks secret values for logging/diagnostics, leaving only the last few characters visible.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,Optional[str]] _analyze_url(uri: str)", "description": "Parses a URL for diagnostic purposes, checking validity, scheme, host, and path.", "scope": "", "scopeKind": ""}, {"name": "Tuple[str,Optional[str]] _resolve_env(names: List[str])", "description": "Resolves environment variable from a list of candidate names, returning the first non-empty value.", "scope": "", "scopeKind": ""}, {"name": "tuple[str|None,str|None] _pick_scheme_host_from_headers(request: Request)", "description": "Infers request scheme and host:port from headers, considering proxy headers.", "scope": "", "scopeKind": ""}, {"name": "str _choose_canonical_redirect(default_path: str)", "description": "Decides the redirect URI for Jira OAuth, based on env variables or default values.", "scope": "", "scopeKind": ""}, {"name": "bool _is_truthy(val: Optional[str | bool])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str build_atlassian_authorize_url(client_id: str, redirect_uri: str, scopes: str, state: Optional[str] = None)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str choose_jira_redirect_with_request(request: Request, callback_path: str = \"/auth/jira/callback\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str,Dict[str,str]] get_active_redirect_uris_debug()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str get_atlassian_base_url()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str,str] get_confluence_oauth_config()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str,str] get_env_bootstrap_debug()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str get_frontend_base_url_default()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str,str] get_jira_oauth_config()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str,Dict[str,str]] get_jira_oauth_env_debug()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "bool is_jira_oauth_configured()", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["load_dotenv", "find_dotenv", "os.getenv", "urllib.parse.urlparse", "urllib.parse.urlunparse", "os.path.dirname", "os.path.normpath", "os.path.join", "str.strip", "str.lower", "str.startswith", "url_for"], "search-terms": ["OAuth configuration", "Atlassian OAuth", "Jira OAuth redirect URL", "Confluence OAuth", "environment variable secrets", "OAuth URL builder", "OAuth environment loader"], "state": 2, "file_id": 12, "knowledge_revision": 257, "git_revision": "fb39651b71098db2c56fe18ccc3ee2db1e86098f", "revision_history": [{"38": ""}, {"54": "906ba192e73f2ea439ac8fce13c4ec73b18ccf62"}, {"243": "edffa28eb1150a3ca91ed855c6f59fb26c0ef310"}, {"245": "6061f6c901ae3c55da64b24a7ffa3ebef9fcf54e"}, {"246": "6061f6c901ae3c55da64b24a7ffa3ebef9fcf54e"}, {"247": "6061f6c901ae3c55da64b24a7ffa3ebef9fcf54e"}, {"250": "e83268a392e758f73af34ecab9c7137939e157aa"}, {"251": "e83268a392e758f73af34ecab9c7137939e157aa"}, {"252": "e83268a392e758f73af34ecab9c7137939e157aa"}, {"255": "fb39651b71098db2c56fe18ccc3ee2db1e86098f"}, {"256": "fb39651b71098db2c56fe18ccc3ee2db1e86098f"}, {"257": "fb39651b71098db2c56fe18ccc3ee2db1e86098f"}], "ctags": [{"_type": "tag", "name": "ATLASSIAN_BASE_ENV_CANDIDATES", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^ATLASSIAN_BASE_ENV_CANDIDATES: List[str] = [$/", "language": "Python", "typeref": "typename:List[str]", "kind": "variable"}, {"_type": "tag", "name": "FRONTEND_URL_ENV_CANDIDATES", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^FRONTEND_URL_ENV_CANDIDATES: List[str] = [$/", "language": "Python", "typeref": "typename:List[str]", "kind": "variable"}, {"_type": "tag", "name": "JIRA_ID_ENV_CANDIDATES", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^JIRA_ID_ENV_CANDIDATES: List[str] = [$/", "language": "Python", "typeref": "typename:List[str]", "kind": "variable"}, {"_type": "tag", "name": "JIRA_REDIRECT_ENV_CANDIDATES", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^JIRA_REDIRECT_ENV_CANDIDATES: List[str] = [$/", "language": "Python", "typeref": "typename:List[str]", "kind": "variable"}, {"_type": "tag", "name": "JIRA_SECRET_ENV_CANDIDATES", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^JIRA_SECRET_ENV_CANDIDATES: List[str] = [$/", "language": "Python", "typeref": "typename:List[str]", "kind": "variable"}, {"_type": "tag", "name": "Settings", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^class Settings(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_DOTENV_STATUS", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^_DOTENV_STATUS: Dict[str, Optional[str]] = {\"loaded\": \"false\", \"path\": None}$/", "language": "Python", "typeref": "typename:Dict[str, Optional[str]]", "kind": "variable"}, {"_type": "tag", "name": "_SETTINGS", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^_SETTINGS = Settings()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_analyze_url", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^def _analyze_url(uri: str) -> Dict[str, Optional[str]]:$/", "language": "Python", "typeref": "typename:Dict[str,Optional[str]]", "kind": "function", "signature": "(uri: str)"}, {"_type": "tag", "name": "_choose_canonical_redirect", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^def _choose_canonical_redirect(default_path: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(default_path: str)"}, {"_type": "tag", "name": "_env_first", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^def _env_first(*names: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(*names: str)"}, {"_type": "tag", "name": "_is_truthy", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^def _is_truthy(val: Optional[str | bool]) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(val: Optional[str | bool])"}, {"_type": "tag", "name": "_load_env_once", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^def _load_env_once() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_mask_secret", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^def _mask_secret(value: Optional[str], keep: int = 4) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(value: Optional[str], keep: int = 4)"}, {"_type": "tag", "name": "_pick_scheme_host_from_headers", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^def _pick_scheme_host_from_headers(request: Request) -> tuple[str | None, str | None]:$/", "language": "Python", "typeref": "typename:tuple[str|None,str|None]", "kind": "function", "signature": "(request: Request)"}, {"_type": "tag", "name": "_resolve_env", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^def _resolve_env(names: List[str]) -> Tuple[str, Optional[str]]:$/", "language": "Python", "typeref": "typename:Tuple[str,Optional[str]]", "kind": "function", "signature": "(names: List[str])"}, {"_type": "tag", "name": "app_env", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^    app_env: str = Field(default=os.getenv(\"APP_ENV\", os.getenv(\"ENV\", \"production\")))$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "Settings", "scopeKind": "class"}, {"_type": "tag", "name": "atlassian_base_url", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^    atlassian_base_url: Optional[str] = Field(default=_env_first(\"ATLASSIAN_CLOUD_BASE_URL\", \"NE/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "Settings", "scopeKind": "class"}, {"_type": "tag", "name": "backend_cors_origins", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^    backend_cors_origins: str = Field(default=os.getenv(\"BACKEND_CORS_ORIGINS\", os.getenv(\"NEXT_/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "Settings", "scopeKind": "class"}, {"_type": "tag", "name": "build_atlassian_authorize_url", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^def build_atlassian_authorize_url(client_id: str, redirect_uri: str, scopes: str, state: Optiona/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(client_id: str, redirect_uri: str, scopes: str, state: Optional[str] = None)"}, {"_type": "tag", "name": "choose_jira_redirect_with_request", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^def choose_jira_redirect_with_request(request: Request, callback_path: str = \"\\/auth\\/jira\\/call/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(request: Request, callback_path: str = \"/auth/jira/callback\")"}, {"_type": "tag", "name": "confluence_client_id", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^    confluence_client_id: Optional[str] = Field(default=_env_first(\"CONFLUENCE_OAUTH_CLIENT_ID\",/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "Settings", "scopeKind": "class"}, {"_type": "tag", "name": "confluence_client_secret", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^    confluence_client_secret: Optional[str] = Field(default=_env_first(\"CONFLUENCE_OAUTH_CLIENT_/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "Settings", "scopeKind": "class"}, {"_type": "tag", "name": "confluence_redirect_uri", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^    confluence_redirect_uri: Optional[str] = Field(default=_env_first(\"ATLASSIAN_OAUTH_REDIRECT_/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "Settings", "scopeKind": "class"}, {"_type": "tag", "name": "dev_mode", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^    dev_mode: bool = Field(default=os.getenv(\"DEV_MODE\", \"false\").lower() in (\"1\", \"true\", \"yes\"/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "Settings", "scopeKind": "class"}, {"_type": "tag", "name": "find_dotenv", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^    find_dotenv = None  # type: ignore$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "frontend_url", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^    frontend_url: Optional[str] = Field(default=_env_first(\"APP_FRONTEND_URL\", \"NEXT_PUBLIC_APP_/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "Settings", "scopeKind": "class"}, {"_type": "tag", "name": "get_active_redirect_uris_debug", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^def get_active_redirect_uris_debug() -> Dict[str, Dict[str, str]]:$/", "language": "Python", "typeref": "typename:Dict[str,Dict[str,str]]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_atlassian_base_url", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^def get_atlassian_base_url() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_confluence_oauth_config", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^def get_confluence_oauth_config() -> Dict[str, str]:$/", "language": "Python", "typeref": "typename:Dict[str,str]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_env_bootstrap_debug", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^def get_env_bootstrap_debug() -> Dict[str, str]:$/", "language": "Python", "typeref": "typename:Dict[str,str]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_frontend_base_url_default", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^def get_frontend_base_url_default() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_jira_oauth_config", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^def get_jira_oauth_config() -> Dict[str, str]:$/", "language": "Python", "typeref": "typename:Dict[str,str]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_jira_oauth_env_debug", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^def get_jira_oauth_env_debug() -> Dict[str, Dict[str, str]]:$/", "language": "Python", "typeref": "typename:Dict[str,Dict[str,str]]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "is_jira_oauth_configured", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^def is_jira_oauth_configured() -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "jira_client_id", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^    jira_client_id: Optional[str] = Field(default=_env_first(\"JIRA_OAUTH_CLIENT_ID\", \"ATLASSIAN_/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "Settings", "scopeKind": "class"}, {"_type": "tag", "name": "jira_client_secret", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^    jira_client_secret: Optional[str] = Field(default=_env_first(\"JIRA_OAUTH_CLIENT_SECRET\", \"AT/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "Settings", "scopeKind": "class"}, {"_type": "tag", "name": "jira_redirect_uri", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^    jira_redirect_uri: Optional[str] = Field(default=_env_first(\"JIRA_REDIRECT_URI\"))$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "Settings", "scopeKind": "class"}, {"_type": "tag", "name": "load_dotenv", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^    load_dotenv = None  # type: ignore$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "log_level", "path": "/home/kavia/workspace/code-generation/jira-confluence-connector-146762-146772/integration_backend/src/api/oauth_config.py", "pattern": "/^    log_level: str = Field(default=os.getenv(\"LOG_LEVEL\", \"INFO\"))$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "Settings", "scopeKind": "class"}], "hash": "6f9029703d2646267d116d1d289f2fd0", "format-version": 4, "code-base-name": "integration_backend", "filename": "integration_backend/src/api/oauth_config.py", "fields": [{"name": "List[str] ATLASSIAN_BASE_ENV_CANDIDATES", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "List[str] FRONTEND_URL_ENV_CANDIDATES", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "List[str] JIRA_ID_ENV_CANDIDATES", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "List[str] JIRA_REDIRECT_ENV_CANDIDATES", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "List[str] JIRA_SECRET_ENV_CANDIDATES", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str, Optional[str]] _DOTENV_STATUS", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_SETTINGS = Settings()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str app_env", "scope": "Settings", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] atlassian_base_url", "scope": "Settings", "scopeKind": "class", "description": "unavailable"}, {"name": "str backend_cors_origins", "scope": "Settings", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] confluence_client_id", "scope": "Settings", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] confluence_client_secret", "scope": "Settings", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] confluence_redirect_uri", "scope": "Settings", "scopeKind": "class", "description": "unavailable"}, {"name": "bool dev_mode", "scope": "Settings", "scopeKind": "class", "description": "unavailable"}, {"name": "find_dotenv = None  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[str] frontend_url", "scope": "Settings", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] jira_client_id", "scope": "Settings", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] jira_client_secret", "scope": "Settings", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] jira_redirect_uri", "scope": "Settings", "scopeKind": "class", "description": "unavailable"}, {"name": "load_dotenv = None  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str log_level", "scope": "Settings", "scopeKind": "class", "description": "unavailable"}]}